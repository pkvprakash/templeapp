CREATE DATABASE TEMPLE_DEV;

USE TEMPLE_DEV;

CREATE TABLE `TEMPLE_ROLE` (
  `ROLEID` varchar(50) NOT NULL,
  `ROLE` varchar(200) NOT NULL,
  `SDESC` varchar(500) DEFAULT NULL,
  PRIMARY KEY (`ROLEID`),
  UNIQUE KEY `ROLEID` (`ROLEID`)
) ENGINE=InnoDB;

CREATE TABLE `TEMPLE_USER` (
  `NAME` varchar(100) NOT NULL,
  `UNAME` varchar(50) NOT NULL,
  `PASSWD` varchar(200) NOT NULL,
  `ROLEID` varchar(50) NOT NULL,
  `ADDRESS` varchar(350) NOT NULL,
  `PHONE` varchar(20) DEFAULT NULL,
  `EMAIL` varchar(100) DEFAULT NULL,
  PRIMARY KEY (`UNAME`),
  UNIQUE KEY `UNAME` (`UNAME`),
  KEY `fk_TEMPLE_USER_1` (`ROLEID`),
  CONSTRAINT `fk_TEMPLE_USER_1` FOREIGN KEY (`ROLEID`) REFERENCES `TEMPLE_ROLE` (`ROLEID`) ON UPDATE CASCADE
) ENGINE=InnoDB;

CREATE TABLE `TEMPLE_OFFER` (
  `OFFER_NUM` int(11) NOT NULL AUTO_INCREMENT,
  `OFFER_ID` varchar(50) NOT NULL,
  `PRICE` double NOT NULL DEFAULT '0',
  `OFFER_NAME` varchar(200) NOT NULL,
  PRIMARY KEY (`OFFER_ID`),
  UNIQUE KEY `OFFERING_ID_UNIQUE` (`OFFER_NUM`),
  UNIQUE KEY `OFFER_ID_UNIQUE` (`OFFER_ID`)
) ENGINE=InnoDB;

CREATE TABLE `TEMPLE_GOD` (
  `GOD_ID` varchar(50) NOT NULL,
  `GOD_NAME` varchar(100) NOT NULL,
  PRIMARY KEY (`GOD_ID`),
  UNIQUE KEY `GOD_ID_UNIQUE` (`GOD_ID`)
) ENGINE=InnoDB;

CREATE TABLE `TEMPLE_BOOKING_RECORD` (
  `BOOKING_ID` int(11) NOT NULL,
  `RECORD_ID` int(11) NOT NULL,
  `OFFER_ID` varchar(50) NOT NULL,
  `NAME` varchar(100) NOT NULL,
  `STAR` varchar(50) NOT NULL,
  `QUANTITY` int(11) NOT NULL DEFAULT '1',
  `AMOUNT` double NOT NULL DEFAULT '0',
  `GOD_ID` varchar(50) NOT NULL,
  PRIMARY KEY (`BOOKING_ID`,`RECORD_ID`),
  KEY `fk_TEMPLE_BOOKING_RECORD_1` (`OFFER_ID`),
  KEY `fk_TEMPLE_BOOKING_RECORD_2` (`GOD_ID`),
  CONSTRAINT `fk_TEMPLE_BOOKING_RECORD_2` FOREIGN KEY (`GOD_ID`) REFERENCES `TEMPLE_GOD` (`GOD_ID`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_TEMPLE_BOOKING_RECORD_1` FOREIGN KEY (`OFFER_ID`) REFERENCES `TEMPLE_OFFER` (`OFFER_ID`) ON DELETE NO ACTION ON UPDATE CASCADE
) ENGINE=InnoDB;

CREATE TABLE `TEMPLE_BOOKING` (
  `BOOKING_ID` int(11) NOT NULL AUTO_INCREMENT,
  `UNAME` varchar(50) NOT NULL,
  `BTYPE` varchar(50) NOT NULL DEFAULT 'DAILY',
  `CNAME` varchar(100) DEFAULT NULL,
  `CADDRESS` varchar(350) DEFAULT NULL,
  `BOOKING_DATE` date NOT NULL,
  `AMOUNT` double NOT NULL DEFAULT '0',
  `BOOKED_ON` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`BOOKING_ID`),
  KEY `fk_TEMPLE_BOOKING_1` (`UNAME`),
  KEY `fk_TEMPLE_BOOKING_2` (`BOOKING_ID`),
  CONSTRAINT `fk_TEMPLE_BOOKING_2` FOREIGN KEY (`BOOKING_ID`) REFERENCES `TEMPLE_BOOKING_RECORD` (`BOOKING_ID`) ON DELETE CASCADE,
  CONSTRAINT `fk_TEMPLE_BOOKING_1` FOREIGN KEY (`UNAME`) REFERENCES `TEMPLE_USER` (`UNAME`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB;


INSERT INTO TEMPLE_ROLE VALUES ('admin', 'Administrator', 'System Administrator');
INSERT INTO TEMPLE_ROLE VALUES ('user', 'User', 'System user');

INSERT INTO TEMPLE_USER VALUES ('TEMPLE_USERAdministrator 1', 'admin1', SHA1('admin123'), 'admin', 'Administrator 1 Address', NULL, NULL);
INSERT INTO TEMPLE_USER VALUES ('User 1', 'user1', SHA1('user123'), 'user', 'User 1 Address', NULL, NULL);

