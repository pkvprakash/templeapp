CREATE DATABASE TEMPLE;

USE TEMPLE;

CREATE TABLE `TEMPLE`.`TEMPLE_USER`
(
    `NAME`    VARCHAR(100)    NOT NULL,
    `UNAME`   VARCHAR(50)     UNIQUE NOT NULL,
    `PASSWD`  VARCHAR(200)    NOT NULL,
    `ROLEID`  VARCHAR(50)     NOT NULL,
    `ADDRESS` VARCHAR(350)    NOT NULL,
    `PHONE`   VARCHAR(20),
    `EMAIL`   VARCHAR(100)
);

CREATE TABLE `TEMPLE`.`TEMPLE_ROLE`
(
    `ROLEID`  VARCHAR(50)     UNIQUE NOT NULL,
    `ROLE`    VARCHAR(200)    NOT NULL,
    `SDESC`   VARCHAR(500)    
);

ALTER TABLE `TEMPLE`.`TEMPLE_USER` ADD PRIMARY KEY (`UNAME`) ;
ALTER TABLE `TEMPLE`.`TEMPLE_ROLE` ADD PRIMARY KEY (`ROLEID`) ;
    
ALTER TABLE `TEMPLE`.`TEMPLE_USER` 
  ADD CONSTRAINT `fk_TEMPLE_USER_1`
  FOREIGN KEY (`ROLEID` )
  REFERENCES `TEMPLE`.`TEMPLE_ROLE` (`ROLEID` )
  ON DELETE RESTRICT
  ON UPDATE CASCADE
, ADD INDEX `fk_TEMPLE_USER_1` (`ROLEID` ASC) ;

CREATE  TABLE `TEMPLE`.`TEMPLE_OFFER` (
  `OFFER_NUM`   INT NOT NULL AUTO_INCREMENT ,
  `OFFER_ID`    VARCHAR(50) NOT NULL ,
  `PRICE`       DOUBLE NOT NULL DEFAULT 0.00 ,
  `OFFER_NAME`  VARCHAR(200) NOT NULL ,
  UNIQUE INDEX `OFFERING_ID_UNIQUE` (`OFFER_NUM` ASC) ,
  PRIMARY KEY (`OFFER_ID`) ,
  UNIQUE INDEX `OFFER_ID_UNIQUE` (`OFFER_ID` ASC) )
ENGINE = InnoDB;

CREATE  TABLE `TEMPLE`.`TEMPLE_BOOKING` (
  `BOOKING_ID` INT NOT NULL AUTO_INCREMENT ,
  `UNAME` VARCHAR(50) NOT NULL ,
  `BTYPE` VARCHAR(50) NOT NULL DEFAULT 'DAILY' ,
  `CNAME` VARCHAR(100) NULL ,
  `CADDRESS` VARCHAR(350) NULL ,
  `BOOKING_DATE` DATE NOT NULL ,
  `AMOUNT` DOUBLE NOT NULL DEFAULT 0.00 ,
  `BOOKED_ON` TIMESTAMP NOT NULL ,
  PRIMARY KEY (`BOOKING_ID`) );

CREATE TABLE `TEMPLE_BOOKING_RECORD` (
  `BOOKING_ID` int(11) NOT NULL,
  `RECORD_ID` int(11) NOT NULL,
  `OFFER_ID` varchar(50) NOT NULL,
  `NAME` varchar(100) NOT NULL,
  `STAR` varchar(50) NOT NULL,
  `QUANTITY` int(11) NOT NULL DEFAULT '1',
  `AMOUNT` double NOT NULL DEFAULT '0',
  PRIMARY KEY (`BOOKING_ID`,`RECORD_ID`)
) ENGINE=InnoDB;


ALTER TABLE `TEMPLE`.`TEMPLE_BOOKING` 
  ADD CONSTRAINT `fk_TEMPLE_BOOKING_1`
  FOREIGN KEY (`UNAME` )
  REFERENCES `TEMPLE`.`TEMPLE_USER` (`UNAME` )
  ON DELETE NO ACTION
  ON UPDATE NO ACTION
, ADD INDEX `fk_TEMPLE_BOOKING_1` (`UNAME` ASC) ;

ALTER TABLE `TEMPLE`.`TEMPLE_BOOKING` 
  ADD CONSTRAINT `fk_TEMPLE_BOOKING_2`
  FOREIGN KEY (`BOOKING_ID` )
  REFERENCES `TEMPLE`.`TEMPLE_BOOKING_RECORD` (`BOOKING_ID` )
  ON DELETE CASCADE
  ON UPDATE RESTRICT
, ADD INDEX `fk_TEMPLE_BOOKING_2` (`BOOKING_ID` ASC) ;

ALTER TABLE `TEMPLE`.`TEMPLE_BOOKING_RECORD` 
  ADD CONSTRAINT `fk_TEMPLE_BOOKING_RECORD_1`
  FOREIGN KEY (`OFFER_ID` )
  REFERENCES `TEMPLE`.`TEMPLE_OFFER` (`OFFER_ID` )
  ON DELETE NO ACTION
  ON UPDATE CASCADE
, ADD INDEX `fk_TEMPLE_BOOKING_RECORD_1` (`OFFER_ID` ASC) ;
